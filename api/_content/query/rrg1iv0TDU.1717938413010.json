{"_path":"/blog/hacking-pysyft","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Hack PySyft - Find Bugs Before the Malicious Guys","description":"On July 31st, 2019, Trask launched the Hack PySyft initiative, saying 'Some day, when PySyft is deployed in production around the world, someone evil is going to try to hack PySyft and steal personal data...","date":"2019-08-01T00:00:00.000Z","image":"/img/OpenMined.jpg","draft":false,"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Starting from May 2019 I've been part of the "},{"type":"element","tag":"a","props":{"href":"https://sites.google.com/udacity.com/secureprivateai-challenge/","rel":["nofollow"]},"children":[{"type":"text","value":"Secure and Private AI Scholarship"}]},{"type":"text","value":" sponsored by Facebook, the course was taught by "},{"type":"element","tag":"a","props":{"href":"http://twitter.com/iamtrask","rel":["nofollow"]},"children":[{"type":"text","value":"Andrew Trask"}]},{"type":"text","value":" and covered topics around privacy preserving deep learning, we also learned about "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft","rel":["nofollow"]},"children":[{"type":"text","value":"PySyft"}]},{"type":"text","value":" and I had the chance to start contributing to this amazing project."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On July 31st, 2019, Trask launched the "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/issues/2421","rel":["nofollow"]},"children":[{"type":"text","value":"Hack PySyft"}]},{"type":"text","value":" initiative, saying "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"'Some day, when PySyft is deployed in production around the world, someone evil is going to try to hack PySyft and steal personal data. This Issue is where we try to do it first.'"}]},{"type":"text","value":" So the challenge was to hack PySyft (and fix it) before that attackers do. I got motivated and started bug hunting the next day. For the rest of this post I will walk you through my approach to finding a way to steal remote private data and how I fixed it. If you want to check the fix directly, then you can find it "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/pull/2434","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"the-context"},"children":[{"type":"text","value":"The Context"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before talking about my approach, I should first give you an overview of the environment and what we are trying to achieve, so here is a figure explaining the architecture"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"pysyft hacking context","src":"/img/pysyft-hacking-context.jpg"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm actually running these workers on the same machine, but the same scenario applies when they are distributed among different nodes. So here I'm controlling the evil worker and want to access private tensors on alice, bob and charlie workers that I know are holding 1 as value for their id."}]},{"type":"element","tag":"h2","props":{"id":"my-approach"},"children":[{"type":"text","value":"My Approach"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In a normal scenario where we do federated learning among a group of workers, we can use send() and recv() on tensors to move them around workers. When we send a tensor to a remote worker, we get a pointer referencing the transferred tensor on the remote machine, this pointer holds the id of the tensor and can be used to get it back or make remote operations on it (e.g addition). So the first thing that got into my mind was to construct a valid pointer referencing a private remote tensor since I know its id, this method worked just fine and I was able to get those private tensors, I even started posting on slack about it! Unfortunately, I was running an old version and Trask had already fixed that at that moment and private tensors weren't accessible anymore (another bad news is that slack doesn't have a feature to delete personal messages :/). You can see that fix below on line 5 or check the full code on Github "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/blob/e8f0f6df90b01d734c8d4ea6b84be08aec2edcbd/syft/workers/base.py#L450","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes monokai","code":"def get_obj(self, obj_id: Union[str, int]) -> object:\n        obj = super().get_obj(obj_id)\n        if hasattr(obj, \"child\") and hasattr(obj.child, \"set_garbage_collect_data\"):\n            obj.child.set_garbage_collect_data(value=False)\n        if hasattr(obj, \"private\") and obj.private:\n            return None\n        return obj\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#A6E22E"},"children":[{"type":"text","value":" get_obj"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"obj_id"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":": Union["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"]) -> "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"object"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"        obj "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":" super"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"().get_obj(obj_id)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"        if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF"},"children":[{"type":"text","value":" hasattr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"(obj, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E6DB74"},"children":[{"type":"text","value":"\"child\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF"},"children":[{"type":"text","value":" hasattr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"(obj.child, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E6DB74"},"children":[{"type":"text","value":"\"set_garbage_collect_data\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"            obj.child.set_garbage_collect_data("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"False"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"        if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF"},"children":[{"type":"text","value":" hasattr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"(obj, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E6DB74"},"children":[{"type":"text","value":"\"private\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"and"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" obj.private:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"            return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":" None\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"        return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" obj\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So I started using the last version and changed my strategy, knowing that cloning the tensor will not keep the private attribute, I started trying to clone it, however calling clone() on my constructed pointer was always aborting the connection between my worker and the remote one due to an error that I wasn't able to explain since it works just fine with a tensor I sent myself, if anyone is interested then this path might also be interesting."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here I knew that I have to try harder and started exploring the code to find a way to delete that private attribute and found "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/blob/e8f0f6df90b01d734c8d4ea6b84be08aec2edcbd/syft/workers/base.py#L340","rel":["nofollow"]},"children":[{"type":"text","value":"this interesting method"}]},{"type":"text","value":" about executing commands on tensors and it wasn't making restrictions on private ones, you can see "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/blob/e8f0f6df90b01d734c8d4ea6b84be08aec2edcbd/syft/workers/base.py#L358","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" that it's just accessing the object using its id, however, to trigger this function on a remote worker we had to send a message of type MSGTYPE.CMD with the id of the remote object as well as the name and arguments of the method to call, this limited me to the set of methods a tensor has. Here are the functions I used to construct those messages and send them to the remote workers"}]},{"type":"element","tag":"pre","props":{"className":"language-python shiki shiki-themes monokai","code":"from syft import codes\nimport binascii\n\ndef command_msg(cname, oid, args: list, kwargs: dict) -> tuple:\n    mtype = codes.MSGTYPE.CMD\n    msg = (mtype, ((cname, oid, args, kwargs), []))\n    return msg\n\ndef send_command(ws_client, message):\n    serialized_message = sy.serde.serialize(message)\n    ws_client.ws.send(str(binascii.hexlify(serialized_message)))\n    response = ws_client.ws.recv()\n    response = binascii.unhexlify(response[2:-1])\n    return sy.serde.deserialize(response)\n\nmsg = command_msg('__str__', 1, [], {})\n","language":"python","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" syft "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" codes\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" binascii\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#A6E22E"},"children":[{"type":"text","value":" command_msg"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"cname"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"oid"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"args"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"list"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"kwargs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"dict"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":") -> "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"tuple"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    mtype "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" codes."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"MSGTYPE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"CMD\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    msg "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" (mtype, ((cname, oid, args, kwargs), []))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" msg\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#A6E22E"},"children":[{"type":"text","value":" send_command"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"ws_client"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FD971F;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    serialized_message "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" sy.serde.serialize(message)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    ws_client.ws.send("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#66D9EF;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"str"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"(binascii.hexlify(serialized_message)))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    response "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" ws_client.ws.recv()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"    response "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" binascii.unhexlify(response["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" sy.serde.deserialize(response)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":"msg "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":" command_msg("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E6DB74"},"children":[{"type":"text","value":"'__str__'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#AE81FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F8F8F2"},"children":[{"type":"text","value":", [], {})\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I wasn't sure about the response I get from the worker so I proceeded by experimentation, first I tried calling clone() and copy() but resulted in an error response, I directly thought about __str__() and was trying it hopelessly late at night, and I started seeing the waited private tensor."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"pysyft ptd poc","src":"/img/pysyft-ptd-poc.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To wrap it up, I was able to steal private tensors by sending command messages to remote workers telling them to run the __str__ method on a tensor that I had prior knowledge of its id, the remote worker was then responding with the string representation of the tensor. You can find the issue where I describe the bug "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/issues/2432","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Fortunately, the problem is now fixed and we will just talk about that."}]},{"type":"element","tag":"h2","props":{"id":"the-fix"},"children":[{"type":"text","value":"The Fix"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The problem was that local private tensors shouldn't be used by remote ones, even if they know their ids, and the execute_command() should follow the same policy as get_obj() did: don't use tensors with private attribute when referenced from a remote worker. You can find the fix "},{"type":"element","tag":"a","props":{"href":"https://github.com/OpenMined/PySyft/pull/2434","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Basically, instead of accessing the object with its id directly, we are now using get_obj() which is already secured and won't return a private tensor."}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Exploring PySyft's code to find security bugs was a good way to learn about the project's heart like the kind of messages that are sent between workers and how a tensor is being manipulated remotely.\nI hope you enjoyed this post and of course if you are a White Hat and can contribute to PySyft by finding and fixing security bugs then give it a shot ;)"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-context","depth":2,"text":"The Context"},{"id":"my-approach","depth":2,"text":"My Approach"},{"id":"the-fix","depth":2,"text":"The Fix"},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:blog:hacking-pysyft.md","_source":"content","_file":"blog/hacking-pysyft.md","_extension":"md"}